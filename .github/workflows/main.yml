name: Android Build with Buildozer

# يتم تشغيل هذا السير العمل عند الرفع إلى فرع main، أو يدوياً عبر واجهة GitHub
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build_android:
    # نستخدم بيئة Ubuntu لأنها الأفضل لعمليات بناء Buildozer
    runs-on: ubuntu-latest

    steps:
    - name: 1. Checkout repository
      # يجلب هذا الأمر الكود من مستودعك
      uses: actions/checkout@v4

    - name: 2. Run Buildozer Android Debug Build
      # ***الإصلاح النهائي والموصى به***
      # تم استبدال الإجراء الفاشل (cseelye/buildozer-action) بالإجراء الرسمي والمستقر
      # من مجتمع Kivy.
      uses: kivy/buildozer-action@v1
      with:
        # الأمر الذي سيتم تنفيذه داخل بيئة Buildozer
        command: buildozer android debug
        # يمكنك تحديد إصدار Python. استخدم الإصدار الذي استخدمته لتطوير تطبيقك.
        python_version: 3.11 # يمكنك تغيير هذا إلى 3.9 أو 3.10 إذا لزم الأمر
        
    - name: 3. Upload APK Artifact
      # يقوم هذا الأمر بحفظ ملف APK الناتج كـ "Artifact" يمكنك تحميله
      uses: actions/upload-artifact@v4
      with:
        name: Salah-AI-Android-APK
        # المسار الافتراضي لملفات APK/AAB التي ينشئها Buildozer
        path: bin/*.apk
        retention-days: 7 # الاحتفاظ بالملف لمدة 7 أيام

